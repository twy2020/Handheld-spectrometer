# 光谱仪上位机软件使用说明书

## 软件概述

光谱仪上位机软件是一款用于控制和监控AS7341光谱仪设备的专业软件，支持实时数据采集、多模式测量、数据记录与分析等功能。软件采用PyQt5开发，具有友好的图形用户界面。

---

## 系统要求

### 硬件要求

- 推荐内存：4GB以上
- 存储空间：至少100MB可用空间
- 网络接口：支持TCP/UDP通信

### 软件要求

- 操作系统：Windows 7/10/11，Linux，macOS
- Python环境：Python 3.12
- 依赖库：PyQt5, pyqtgraph, pandas等

---

## 安装步骤

### 1. 安装Python环境

从Python官网下载并安装Python 3.7或更高版本。

### 2. 安装依赖库

```bash
pip install PyQt5 pyqtgraph pandas
```

### 3. 运行软件

```bash
python Spectrometer_v2_PC.py
```

---

## 界面功能详解

### 1. 顶部状态栏

- **本机IP设置**：设置软件运行的本地IP地址
- **服务状态**：显示TCP/UDP服务器运行状态
- **心跳状态**：显示与设备的心跳通信状态
- **数据传输**：显示光谱数据接收状态
- **设备状态**：显示设备连接状态
- **数据流状态**：显示数据流运行状态

### 2. 设备信息面板

显示连接的设备基本信息：

- 设备名称、固件版本、设备IP
- MAC地址、信号强度(RSSI)
- LED状态（AS7341 LED、UV LED）
- 蜂鸣器状态
- 数据流模式、状态和计数信息

### 3. 数据流控制

- **开启/关闭数据流**：控制设备数据流的启动和停止
- **数据流模式**：
  - 持续发送模式：设备持续发送数据
  - 指定次数模式：设备发送指定次数后停止
- **目标发送次数**：设置指定次数模式的目标值
- **暂停/继续**：临时暂停或恢复数据流
- **重置计数**：重置数据流计数器
- **数据流间隔**：设置数据发送间隔（最小400ms）

### 4. 定时测量控制（新增功能）

- **启用定时测量**：开启/关闭定时测量功能
- **测量总时长**：设置整个测量会话的总时长（1-1440分钟）
- **测量间隔**：设置每次测量的间隔时间（1-1440分钟）
- **立即测量**：手动触发单次测量
- **测量状态**：显示当前测量进度和状态

### 5. 设备参数控制

- **AS7341 LED控制**：开启/关闭AS7341 LED，调节亮度(1-20)
- **UV LED控制**：开启/关闭UV LED，调节亮度(1-20)
- **蜂鸣器控制**：开启/关闭蜂鸣器
- **获取设备状态**：手动请求设备状态信息
- **设备重启**：重启连接的光谱仪设备

### 6. 数据记录控制

- **开始记录**：开始记录接收到的光谱数据
- **停止记录**：停止数据记录
- **保存记录**：将记录的数据保存为CSV文件
- **清空数据**：清除所有缓存和记录数据
- **数据统计**：显示当前缓存和记录的数据点数

### 7. 光谱通道选择

- 8个光谱通道（F1-F8），对应不同波长范围
- 支持全选/全不选功能
- 可单独选择显示的通道

### 8. 横轴模式选择

- **数据序号**：以数据包计数为横轴
- **时间戳**：以时间戳为横轴

---

## 标签页功能

### 1. 实时数据标签页

显示实时光谱数据曲线，支持多通道同时显示。

### 2. LED Only数据标签页

显示仅开启LED时的测量数据平均值。

### 3. UV Only数据标签页

显示仅开启UV灯时的测量数据平均值。

### 4. LED+UV数据标签页

显示同时开启LED和UV灯时的测量数据平均值。

---

## 使用流程

### 1. 初始设置

1. 确认本机IP地址设置正确
2. 确保设备与电脑在同一网络
3. 启动软件，等待服务初始化完成

### 2. 设备连接

1. 设备开机后自动连接软件
2. 观察设备状态显示"在线"
3. 确认数据传输状态正常

### 3. 基本数据采集

1. 在"数据流控制"中开启数据流
2. 选择合适的数据流模式和间隔
3. 在"实时数据"标签页观察光谱曲线

### 4. 定时测量

1. 在"定时测量控制"中启用功能
2. 设置测量总时长和间隔
3. 点击"立即测量"或等待自动测量
4. 在各标签页查看测量结果

### 5. 数据记录与保存

1. 点击"开始记录"开始数据采集
2. 采集完成后点击"停止记录"
3. 使用"保存记录"将数据导出为CSV文件

---

## 高级功能

### 测量序列说明

每次测量包含三个阶段：

1. **LED Only**：仅开启AS7341 LED，采集5次数据
2. **UV Only**：仅开启UV LED，采集5次数据  
3. **LED+UV**：同时开启两种LED，采集5次数据

### 数据文件格式

保存的CSV文件包含以下字段：

- measurement_index：测量序号
- measurement_time：测量时间
- measurement_type：测量类型（LED Only/UV Only/LED+UV）
- data_index：数据点序号
- F1-F8：8个通道的光谱强度值

---

## 故障排除

### 常见问题

1. **设备无法连接**
   
   - 检查IP地址设置是否正确
   - 确认设备与电脑在同一网络
   - 检查防火墙设置

2. **数据接收中断**
   
   - 检查网络连接稳定性
   - 确认UDP端口6699未被占用
   - 重启软件和设备

3. **指令发送失败**
   
   - 检查TCP客户端连接状态
   - 确认设备指令服务器正常运行
   - 查看指令响应提示

4. **测量数据异常**
   
   - 检查LED状态设置
   - 确认设备传感器正常工作
   - 检查环境光照条件

---

## 注意事项

1. 确保设备固件版本(v2.0.0)与软件兼容
2. 数据流间隔不要设置过小，避免数据丢失
3. 定时测量期间保持设备稳定
4. 定期保存重要数据，避免意外丢失
5. 软件关闭前请先停止所有数据流和测量

---

## 技术支持

如遇问题，请提供以下信息：

1. 软件版本号
2. 设备型号和固件版本
3. 错误提示信息
4. 网络环境描述
5. 问题复现步骤

---

**注意**：本软件仅供专业用途，使用时请遵守相关安全规范，未经作者运行，禁止进行商业用途（作者Teng邮箱：tenwonyun@gmail.com）。
